(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[98],{Glit:function(e,t,n){"use strict";n.d(t,"b",(function(){return l}));var r=n("QkVN"),a=n.n(r);function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l={description:"",descriptionError:null,isTaggable:!0,link:"",linkError:null,media:null,pinTagIds:[],selectedPinTagId:null,tagError:null,title:"",titleError:null,canvasJson:null,signals:{},userMentionTags:[]};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PIN_DRAFT_ADD_PIN_ITEM":case"PIN_ITEM_UPDATE_DATA":var n=t.payload.pinItem||{};return s(s(s({},e),n),{},{signals:s(s({},e.signals),n.signals)});case"PIN_ITEM_ADD_PIN_TAG":var r=t.payload.pinTagId;return s(s({},e),{},{pinTagIds:[].concat(o(e.pinTagIds),[r])});case"PIN_ITEM_REMOVE_PIN_TAG":var i=t.payload.pinTagId;return s(s({},e),{},{pinTagIds:e.pinTagIds.filter((function(e){return e!==i}))});case"PIN_ITEM_SET_DESCRIPTION":var u=t.payload.description;return s(s({},e),{},{description:u});case"PIN_ITEM_SET_DESCRIPTION_ERROR":var c=t.payload,d=c.descriptionError,p=c.signals;return s(s({},e),{},{descriptionError:d,signals:s(s({},e.signals),p)});case"PIN_ITEM_SET_IS_TAGGABLE":var f=t.payload.isTaggable;return s(s({},e),{},{isTaggable:f});case"PIN_ITEM_SET_LINK":var g=t.payload.link;return s(s({},e),{},{link:g});case"PIN_ITEM_SET_LINK_ERROR":var m=t.payload,h=m.linkError,b=m.signals;return s(s({},e),{},{linkError:h,signals:s(s({},e.signals),b)});case"PIN_ITEM_SET_MEDIA":var v=t.payload.media,y=!(!v||e.link)||e.isTaggable;return s(s({},e),{},{media:v,isTaggable:(!v||"localVideo"!==v.type)&&y,pinTagIds:[],selectedPinTagId:null,canvasJson:null});case"PIN_ITEM_UPDATE_MEDIA":var I=t.payload.media;return s(s({},e),{},{media:e.media?a()({},e.media,I):null});case"PIN_ITEM_SET_SELECTED_PIN_TAG_ID":var P=t.payload.selectedPinTagId;return s(s({},e),{},{selectedPinTagId:P});case"PIN_ITEM_SET_TAG_ERROR":var S=t.payload.tagError;return s(s({},e),{},{tagError:S});case"PIN_ITEM_SET_TITLE":var M=t.payload.title;return s(s({},e),{},{title:M});case"PIN_ITEM_SET_TITLE_ERROR":var w=t.payload,E=w.titleError,O=w.signals;return s(s({},e),{},{titleError:E,signals:s(s({},e.signals),O)});case"PIN_ITEM_SET_EDITED_IMAGE":var _=t.payload,T=_.editedMedia,U=_.canvasJson;return s(s({},e),{},{media:T,canvasJson:U});default:return e}}},IIK6:function(e,t,n){"use strict";n.d(t,"W",(function(){return r})),n.d(t,"O",(function(){return a})),n.d(t,"N",(function(){return o})),n.d(t,"J",(function(){return i})),n.d(t,"K",(function(){return u})),n.d(t,"L",(function(){return s})),n.d(t,"S",(function(){return c})),n.d(t,"R",(function(){return l})),n.d(t,"P",(function(){return d})),n.d(t,"Q",(function(){return p})),n.d(t,"U",(function(){return f})),n.d(t,"T",(function(){return g})),n.d(t,"V",(function(){return m})),n.d(t,"y",(function(){return h})),n.d(t,"X",(function(){return b})),n.d(t,"u",(function(){return v})),n.d(t,"x",(function(){return y})),n.d(t,"B",(function(){return I})),n.d(t,"v",(function(){return P})),n.d(t,"w",(function(){return S})),n.d(t,"A",(function(){return M})),n.d(t,"t",(function(){return w})),n.d(t,"e",(function(){return E})),n.d(t,"f",(function(){return O})),n.d(t,"fb",(function(){return _})),n.d(t,"b",(function(){return T})),n.d(t,"gb",(function(){return U})),n.d(t,"c",(function(){return A})),n.d(t,"d",(function(){return D})),n.d(t,"hb",(function(){return k})),n.d(t,"a",(function(){return F})),n.d(t,"r",(function(){return j})),n.d(t,"cb",(function(){return C})),n.d(t,"db",(function(){return R})),n.d(t,"eb",(function(){return N})),n.d(t,"s",(function(){return x})),n.d(t,"C",(function(){return H})),n.d(t,"Y",(function(){return L})),n.d(t,"Z",(function(){return G})),n.d(t,"I",(function(){return V})),n.d(t,"ib",(function(){return q})),n.d(t,"q",(function(){return z})),n.d(t,"g",(function(){return X})),n.d(t,"j",(function(){return B})),n.d(t,"i",(function(){return J})),n.d(t,"k",(function(){return K})),n.d(t,"l",(function(){return Z})),n.d(t,"m",(function(){return Q})),n.d(t,"n",(function(){return W})),n.d(t,"p",(function(){return $})),n.d(t,"o",(function(){return Y})),n.d(t,"kb",(function(){return ee})),n.d(t,"jb",(function(){return te})),n.d(t,"nb",(function(){return ne})),n.d(t,"pb",(function(){return re})),n.d(t,"qb",(function(){return ae})),n.d(t,"rb",(function(){return oe})),n.d(t,"mb",(function(){return ie})),n.d(t,"ob",(function(){return ue})),n.d(t,"lb",(function(){return se})),n.d(t,"bb",(function(){return ce})),n.d(t,"M",(function(){return le})),n.d(t,"h",(function(){return de})),n.d(t,"z",(function(){return pe})),n.d(t,"ab",(function(){return fe})),n.d(t,"D",(function(){return ge})),n.d(t,"E",(function(){return me})),n.d(t,"F",(function(){return he})),n.d(t,"H",(function(){return be})),n.d(t,"G",(function(){return ve}));var r=880,a=340,o=510,i=40,u=20,s=4,c=474,l=186,d=40,p=10,f=88,g=183,m=130,h=24,b=400,v=50,y=8,I=8,P=5,S=20,M=13,w=5,E=20,O=Math.pow(E,2),_=100,T=500,U=60,A=100,D=5,k=["attempted","publishing","succeeded","uploading"],F={carousel:[{w:2,h:3},{w:3,h:4},{w:1,h:1}],single:[{w:2,h:3},{w:3,h:4},{w:1,h:1}],story:[{w:9,h:16}]},j=["tl","tc","tr","bl","bc","br"],C=["left","center"],R=["top","center","bottom"],N=["none","uppercase"],x=["sm","md","lg"],H=[1,.75],L=198,G=132,V=(Math.floor(16*G/9),1),q=56,z=240,X="cubic-bezier(0.66, 0.025, 0.33, 0.975)",B=["image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/webp"],J=["bmp","gif","jpg","jpeg","png","tiff","webp"],K=89478485,Z=20971520,Q=100,W=100,$=1e3,Y=1500,ee=["video/mp4","video/x-m4v","video/quicktime"],te=["mp4","m4v","mov"],ne=2147483648,re=4,ae=Q,oe=W,ie=900,ue=.5,se=1.91,ce=2,le=["processing","publishing","saving"],de=2500,pe=3,fe=5e3,ge="pin-builder-default-education-id",me="pin-builder-default-tour-id",he="pin-builder-editing-tour-id",be="pin-builder-partner-modal-education-id",ve="pin-builder-partner-first-tour-id"},ZQVr:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return y})),n.d(t,"b",(function(){return I})),n.d(t,"j",(function(){return S})),n.d(t,"g",(function(){return w})),n.d(t,"h",(function(){return E})),n.d(t,"f",(function(){return O})),n.d(t,"e",(function(){return _})),n.d(t,"i",(function(){return T}));var r=n("1ycI"),a=n("eOdZ"),o=n("zwad");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(s){a=!0,o=s}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d=1e3,p=[200,201,204],f=2e3,g=8e3,m=6e4,h=3e5;function b(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,n=e.split(";"),r=n[0].split(":")[1],a=n[1].split(",")[1],o=atob(a),i=[],u=0;u<o.length;u+=t){for(var s=o.slice(u,u+t),c=new Array(s.length),l=0;l<s.length;l+=1)c[l]=s.charCodeAt(l);var d=new Uint8Array(c);i.push(d)}return new Blob(i,{type:r})}function v(e){return new Promise((function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){if(200===n.status){var r=n.response,a=new FileReader;a.onloadend=function(){var e="string"==typeof a.result?a.result:"";t(e)},a.readAsDataURL(r)}},n.send()}))}function y(){return a.a.create("VisualLinkBoardResource").callCreate().then((function(e){return e.resource_response.data}))}function I(e){return a.a.create("PinResource",e).callCreate().then((function(e){return e.resource_response.data}))}function P(e,t){var n,r,o=t.onSuccess,i=t.onError,u=t.onProcessingStarted,s=t.resolvedAfterProcessingStarted,c=t.delay,l=void 0===c?f:c,d=!1,p=function(){clearTimeout(r),clearTimeout(n)};!function t(){d||a.a.create("VIPResource",{upload_ids:[e]}).callGet().then((function(a){var c=a.resource_response.data;if(c[e]){var f=c[e],g=f.status,b=f.signature,v=f.failure_code;n||(n=setTimeout((function(){d=!0,i("","registered_timeout")}),m)),r||(r=setTimeout((function(){d=!0,i("","processing_timeout")}),h)),"processing"===g||"registered"===g?"processing"===g?(clearTimeout(n),u?s?(clearTimeout(r),u(b)):(u(b),setTimeout((function(){return t()}),l)):setTimeout((function(){return t()}),l)):setTimeout((function(){return t()}),l):"succeeded"===g?(p(),o(b)):(p(),i("VIP status failure code: ".concat(v),null))}else i("VIP upload ID was not returned",null)})).catch((function(){i("VIP failure with checking status",null)}))}()}function S(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0;return new Promise((function(o,i){a.a.create("VIPResource",{type:t}).callCreate().then((function(a){var u=r||{},s=u.onCancelUpload,c=u.onFailureUpload,l=u.onFinishProcessing,m=u.onFinishUpload,h=u.onProgress,b=u.onStartProcessing,v=u.onStartUpload,y=u.setXhr,I=a.resource_response.data,S=I.upload_id,M=I.upload_url,w=I.upload_parameters,E=new Date;v&&v(S);var O=function(e,t){c&&c(S,e,t),i({isError:!0,uploadId:S})},_=new XMLHttpRequest;_.open("POST",M,!0),_.onabort=function(){s&&s(S),i({isError:!1,uploadId:S})},_.onload=function(){if(p.includes(_.status)){var e=new Date,r=(e-E)/d;if(m){var a=_.getResponseHeader("x-amz-request-id"),i=_.getResponseHeader("x-amz-id-2");m({amzId2:i,amzRequestId:a,statusCode:_.status,uploadId:S,uploadTime:r})}P(S,{onProcessingStarted:function(e){return b&&b(S,e),n?o({signature:e,uploadId:S}):void 0},delay:t.includes("image")?f:g,onError:O,onSuccess:function(t){var n=(new Date-e)/d;return l&&l(S,n,t,r),o({signature:t,uploadId:S})},resolvedAfterProcessingStarted:n})}else O("XHR failure status code: ".concat(_.status),null)},_.onerror=function(){_.abort()},h&&(_.upload.onprogress=h),y&&y(_);var T=new FormData;Object.keys(w).forEach((function(e){T.append(e,w[e])})),T.append("file",e),_.send(T)})).catch((function(e){i({isError:!0})}))}))}function M(e){return new Promise((function(t,n){var a=new FormData;a.append("img",e);var i=new XMLHttpRequest;i.open("POST",o.a.absolutify("/upload-image/"),!0),i.setRequestHeader("x-CSRFToken",r.default.getCSRFToken()),i.onload=function(){if(200===i.status){var e=JSON.parse(i.responseText);e.success?t(e):n(new Error(e.error))}else 413===i.status?n(new Error("Oops! Something went wrong while uploading your image. Try uploading a smaller image.")):n(new Error("Oops! Something went wrong while uploading your image (Status code ".concat(i.status,")")))},i.send(a)}))}function w(e){return"string"==typeof e?e.startsWith("data")?M(b(e)):v(e).then((function(e){return M(b(e))})):M(e)}function E(e){return w(e).then((function(e){return new Promise((function(t,n){var r=e.image_url;a.a.create("ScheduledPinResource",{image_url:r,method:"upload"}).callCreate().then((function(e){var n=e.resource_response.data.image_signature;t(n)})).catch((function(){n(new Error("Cannot schedule the Pin."))}))}))})).catch((function(e){throw e}))}function O(e){var t=e.filter((function(e){return!!e.media}));return Promise.all(t.map((function(e){return w(e.media&&e.media.src||"")}))).then((function(e){var t=e.map((function(e){return e.image_url}));return Promise.all([a.a.create("CarouselImageUploaderResource",{image_urls:t}).callUpdate(),t])})).then((function(e){var n=c(e,2),r=n[0],a=n[1],o=r.resource_response.data,i=t.findIndex((function(e,t){return!!o[t].image_signature})),s=(t.find((function(e){return!!e.description}))||{}).description,l=(t.find((function(e){return!!e.link}))||{}).link;return{metadata:{description:s||"",title:(t.find((function(e){return!!e.title}))||{}).title||"",link:l||"",imageSignature:o[i].image_signature||"",image_url:a[0]},slots:t.map((function(e,t){var n=o[t],r=e.description,a=e.title,i=e.link;return u(u({},n),{},{title:a,description:r,link:i})}))}})).catch((function(e){throw e}))}function _(e,t,n,r){return new Promise((function(o,i){a.a.create("VIPEditResource",u({type:t,video_signature:e},n)).callCreate().then((function(e){var t=r||{},n=t.onStartEdits,a=t.onFinishEdits,u=e.resource_response.data.tracking_id,s=new Date;n&&n(u),P(u,{delay:g,onError:function(e){return i(e)},onProcessingStarted:function(e){return o({signature:e,uploadId:u})},onSuccess:function(e){var t=(new Date-s)/d;a&&a(u,t,e),o({signature:e,uploadId:u})},resolvedAfterProcessingStarted:!0})})).catch((function(){i()}))}))}function T(e,t,n){return"string"==typeof e?e.startsWith("data")?S(b(e),t,!1,n):v(e).then((function(e){return S(b(e),t,!1,n)})):S(e,t,!1,n)}},wId3:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var r=n("eOdZ");function a(e,t,n,r,a,o,i){try{var u=e[o](i),s=u.value}catch(c){return void n(c)}u.done?t(s):Promise.resolve(s).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){a(i,r,o,u,s,"next",e)}function s(e){a(i,r,o,u,s,"throw",e)}u(void 0)}))}}var i=[200,201,204],u=1e3;function s(){return(s=o(regeneratorRuntime.mark((function e(t){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.a.create("VIPResource",{upload_ids:t}).callGet();case 3:return n=e.sent,a=n.resource_response.data,e.abrupt("return",t.reduce((function(e,t){return e[t]={failureCode:a[t].failure_code,signature:a[t].signature,status:a[t].status},e}),{}));case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function c(e,t,n,r){return l.apply(this,arguments)}function l(){return(l=o(regeneratorRuntime.mark((function e(t,n,a,o){var s,c,l,d,p,f,g,m,h,b,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.onFailure,c=o.onFinishUpload,l=o.onStartUpload,d=o.onUploadProgress,e.prev=1,e.next=4,r.a.create("VIPResource",{type:a}).callCreate();case 4:return p=e.sent,f=p.resource_response.data,g=f.upload_id,m=f.upload_parameters,h=f.upload_url,l&&l(g),b=new Date,(v=new XMLHttpRequest).open("POST",h,!0),v.onload=function(){if(i.includes(v.status)){if(c){var e=(new Date-b)/u,t=v.getResponseHeader("x-amz-request-id"),r=v.getResponseHeader("x-amz-id-2");c(g,{amzId2:r,amzRequestId:t,uploadTimeSec:e,statusCode:v.status})}}else{var a="image"===n?1:8;s(g,"Failed to upload the media with XHR status code: ".concat(v.status),a,!0)}},v.onerror=function(){s(g,"Failed to upload the media","image"===n?1:8,!0)},d&&(v.upload.onprogress=function(e){d(Math.round(e.loaded/e.total*100))}),y=new FormData,Object.keys(m).forEach((function(e){y.append(e,m[e])})),y.append("file",t),v.send(y),e.abrupt("return",{uploadId:g,xhr:v});case 20:throw e.prev=20,e.t0=e.catch(1),e.t0;case 23:case"end":return e.stop()}}),e,null,[[1,20]])})))).apply(this,arguments)}var d=n("ZQVr");function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var a=v(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?b(e):t}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=["webImage","webVideo"],S=function e(t){var n=this;y(this,e),I(this,"upload",(function(){})),I(this,"onFailure",(function(e,t,r,a){a&&n.numAttempts<n.maxUploadAttempts?n.upload():(n.status="failed",n.callbackHandlers.onFailure(e,t,r))})),I(this,"onFinishProcessing",(function(e,t){n.signature=t.signature,n.callbackHandlers.onFinishProcessing&&n.callbackHandlers.onFinishProcessing(e,t)})),I(this,"onFinishUpload",(function(){var e;(n.status="uploaded",n.callbackHandlers.onFinishUpload)&&(e=n.callbackHandlers).onFinishUpload.apply(e,arguments)})),I(this,"onStartProcessing",(function(e,t){n.signature=t.signature,n.callbackHandlers.onStartProcessing&&n.callbackHandlers.onStartProcessing(e,t)})),I(this,"cancel",(function(){n.xhr&&(n.xhr.abort(),n.callbackHandlers.onCancel&&n.callbackHandlers.onCancel(n.uploadId||""))})),this.media=t.media,this.vipType=t.vipType,this.maxUploadAttempts=t.maxUploadAttempts||1,this.numAttempts=0,this.callbackHandlers=t.callbackHandlers},M=function(e){f(n,e);var t=m(n);function n(e){var r;return y(this,n),I(b(r=t.call(this,e)),"getClassName",(function(){return"ImageUpload"})),I(b(r),"onProcessingFailed",(function(e){r.uploadId&&r.onFailure(r.uploadId,"Failed to process image with uploadId ".concat(r.uploadId," and failureCode ").concat(e),3)})),I(b(r),"onProcessingTimeout",(function(){r.uploadId&&r.onFailure(r.uploadId,"Timed out on processing video with uploadId ".concat(r.uploadId),11)})),I(b(r),"upload",(function(){"localImage"===r.media.type&&(r.numAttempts+=1,c(Object(d.a)(r.media.src),"image",r.vipType,{onFailure:r.onFailure,onFinishUpload:r.onFinishUpload,onStartUpload:r.callbackHandlers.onStartUpload,onUploadProgress:r.callbackHandlers.onUploadProgress}).then((function(e){r.uploadId=e.uploadId,r.xhr=e.xhr,r.status="uploading"})).catch((function(e){r.status="failed",r.onFailure(null,"Failed to register upload with message: ".concat(e),13)})))})),r.signature=P.includes(e.media.type)?e.media.signature:null,r.status=P.includes(e.media.type)?"uploaded":"pending",r}return n}(S),w=function(e){f(n,e);var t=m(n);function n(e){var r;return y(this,n),I(b(r=t.call(this,e)),"getClassName",(function(){return"VideoUpload"})),I(b(r),"onProcessingFailed",(function(e){r.uploadId&&r.onFailure(r.uploadId,"Failed to process video with uploadId ".concat(r.uploadId," and failureCode ").concat(e),10)})),I(b(r),"onProcessingTimeout",(function(){r.uploadId&&r.onFailure(r.uploadId,"Timed out on processing video with uploadId ".concat(r.uploadId),11)})),I(b(r),"upload",(function(){"localVideo"===r.media.type&&(r.numAttempts+=1,c(r.media.fileSrc,"video",r.vipType,{onFailure:r.onFailure,onFinishUpload:r.onFinishUpload,onStartUpload:r.callbackHandlers.onStartUpload,onUploadProgress:r.callbackHandlers.onUploadProgress}).then((function(e){r.uploadId=e.uploadId,r.xhr=e.xhr,r.status="uploading"})).catch((function(e){r.status="failed",r.onFailure(null,"Failed to register upload with message: ".concat(e),7)})))})),r.signature=P.includes(e.media.type)?e.media.signature:null,r.status=P.includes(e.media.type)?"uploaded":"pending",r}return n}(S);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,"checkAllUploadsProcessingOrCompleted",(function(){for(var e=0,t=0,r=Object.keys(n.mediaUploadsMap);t<r.length;t++){var a=r[t],o=n.mediaUploadsMap[a];n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Status of media upload ID",a,o.mediaUpload.getClassName(),o.status),("completed"===o.status||"processing"===o.status&&"VideoUpload"===o.mediaUpload.getClassName())&&(e+=1)}return n.inDebugMode&&(console.log("[MEDIA UPLOAD MANAGER] - Checking if all upload processes completed"),console.log("Number of completed uploads:",e)),e===Object.keys(n.mediaUploadsMap).length})),_(this,"checkUploadsFailed",(function(){return!!Object.keys(n.mediaUploadsMap).find((function(e){return"failed"===n.mediaUploadsMap[e].status}))})),_(this,"updateUploadStatus",(function(e,t){return n.mediaUploadsMap[e].status=t})),_(this,"updateVIPStatusMap",(function(e){for(var t=new Date,r=0,a=Object.keys(e);r<a.length;r++){var o=a[r],i=e[o],u=i.failureCode,s=i.signature,c=i.status;if(o in n.vipStatusMap){var l=n.vipStatusMap[o].mediaId,d=n.mediaUploadsMap[l];if(u){d.mediaUpload.onProcessingFailed(u),n.updateUploadStatus(l,"failed");break}if(n.vipStatusMap[o].status!==c){if(n.vipStatusMap[o]=O(O({},n.vipStatusMap[o]),{},{status:c,timeSet:t}),"processing"===c)d.mediaUpload.onStartProcessing(o,{signature:s}),n.updateUploadStatus(l,"processing");else if("succeeded"===c){var p=(t-n.vipStatusMap[o].timeSet)/1e3;d.mediaUpload.onFinishProcessing(o,{processingTimeSec:p,signature:s}),n.updateUploadStatus(l,"completed")}}else n.statusTimeoutMap[c]&&(t-n.vipStatusMap[o].timeSet)/1e3>=n.statusTimeoutMap[c].timeoutSec&&(d.mediaUpload.onProcessingTimeout(),n.statusTimeoutMap[c].onTimeout())}}})),_(this,"handleFailure",(function(e,t){n.failed||(n.onFailure(e,t),n.failed=!0)})),_(this,"handleCheckUploadsCompleted",(function(){var e=n.checkAllUploadsProcessingOrCompleted();return e&&n.onCompleted&&!n.completed&&(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - All uploads have completed & we are triggering the onCompleted callback"),n.completed=!0,n.onCompleted()),e})),_(this,"onFinishUpload",(function(e,t){n.vipStatusMap[e]={mediaId:t,status:null,timeSet:new Date},n.updateUploadStatus(t,"uploaded"),n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Finished uploading media ID",t),n.checkingStatus||(n.checkingStatus=!0,setTimeout((function(){return n.checkStatus()}),2e3))})),_(this,"onUploadFailed",(function(e,t,r){n.updateUploadStatus(e,"failed"),n.handleFailure(t,r),n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Failed uploading media ID",e)})),_(this,"removeMediaUpload",(function(e){n.mediaUploadsMap[e]&&(n.mediaUploadsMap[e].mediaUpload.cancel(),delete n.mediaUploadsMap[e])})),_(this,"addMediaUpload",(function(e,t,r,a){var o=O(O({},a),{},{onFailure:function(e,r,o){n.onUploadFailed(t,r,o),a.onFailure(e,r,o)},onFinishUpload:function(e,r){n.onFinishUpload(e,t),a.onFinishUpload&&a.onFinishUpload(e,r)}}),i="localImage"===e.type||"webImage"===e.type?new M({callbackHandlers:o,media:e,maxUploadAttempts:n.maxMediaUploadAttempts,vipType:"pinimage"}):new w({callbackHandlers:o,media:e,maxUploadAttempts:n.maxMediaUploadAttempts,vipType:"video-story-pin"});if(n.mediaUploadsMap[t]){n.mediaUploadsMap[t].mediaUpload.cancel();var u=n.mediaUploadsMap[t].mediaUpload.uploadId;u&&u in n.vipStatusMap&&delete n.vipStatusMap[u]}n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Added media ID to upload",t),n.mediaUploadsMap[t]={mediaUpload:i,status:"pending"},i.upload(),n.updateUploadStatus(t,"uploading")})),_(this,"reset",(function(){n.failed=!1,n.statusCheckFailureCount=0,n.completed=!1})),_(this,"cancelAll",(function(){for(var e=0,t=Object.keys(n.mediaUploadsMap);e<t.length;e++){var r=t[e];"uploading"===n.mediaUploadsMap[r].status&&n.mediaUploadsMap[r].mediaUpload.cancel()}})),_(this,"checkStatus",(function(){if(n.checkUploadsFailed())return n.checkingStatus=!1,void(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] There is a failure in check status",n.vipStatusMap));n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Checking status",n.vipStatusMap),n.checkingStatus=!0,function(e){return s.apply(this,arguments)}(Object.keys(n.vipStatusMap)).then((function(e){n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Check status response received",n.vipStatusMap),n.updateVIPStatusMap(e);for(var t=n.handleCheckUploadsCompleted(),r=0,a=Object.keys(n.vipStatusMap);r<a.length;r++){var o=a[r],i=n.vipStatusMap[o].mediaId;"completed"===n.mediaUploadsMap[i].status&&delete n.vipStatusMap[o]}Object.keys(n.vipStatusMap).length>0&&!t?setTimeout((function(){return n.checkStatus()}),2e3):n.checkingStatus=!1})).catch((function(e){n.statusCheckFailureCount+=1,n.statusCheckFailureCount>2?(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Failing upload because status check failed ".concat(n.statusCheckFailureCount," times")),n.handleFailure("Could not check VIP status",14),n.checkingStatus=!1):(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Continuing upload because status check only failed ".concat(n.statusCheckFailureCount," times")),setTimeout((function(){return n.checkStatus()}),2e3))}))})),this.onCancel=t.onCancel,this.onCompleted=t.onCompleted||null,this.onFailure=t.onFailure,this.statusTimeoutMap=t.statusTimeoutMap,this.maxMediaUploadAttempts=t.maxMediaUploadAttempts,this.inDebugMode=t.inDebugMode,this.checkingStatus=!1,this.completed=!1,this.failed=!1,this.statusCheckFailureCount=0,this.mediaUploadsMap={},this.vipStatusMap={}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/js/98-0fb2f1947600b04312f5.js.map